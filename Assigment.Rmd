---
title: "R_assignment"
author: "Yu-Ru Chen"
date: "3/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data inspection

##Load the 2 files into genotype and pos data frame

```{r}
library(tidyverse)

genotype <- as.data.frame(read.table("fang_et_al_genotypes.txt", sep="\t",header=TRUE))
pos <- as.data.frame(read.table("snp_position.txt", sep="\t",header=TRUE))
str(genotype)
str(pos)

```

## SNP genotypes data
`fang_et_al_genotypes.txt`
```{r}
genotype %>% 
  group_by(Group) %>% 
  count()

```

## SNP markers information
`snp_position.txt`



# Data processing

##Subset the pos data frame to keep the SNP_ID, Chr, and Pos columns
>adjust the characters of the column and remove the `unknown` and `multiple` which are regarded as NAs out

```{r}

posred <- pos %>% 
  select(SNP_ID, Chromosome, Position) %>% 
  mutate(Chromosome=as.numeric(Chromosome),
         Position=as.numeric(Position))%>%  
  filter_all(all_vars(. != "NA")) 

str(posred)

```


##Subset the genotype data into maize and teosinte datasets

```{r}

maize <- genotype[which(genotype$Group=="ZMMIL" | genotype$Group =="ZMMLR" | genotype$Group == "ZMMMR"),]
teosinte <-genotype[which(genotype$Group=="ZMPBA" | genotype$Group =="ZMPIL" | genotype$Group == "ZMPJA"),]

```



##Formatting the maize file to merge the redPos and maize file

```{r}

maize <- maize[,c(-2,-3)]
maize[1:6,1:6] ## have a look
maize <- t(maize)
maize <- cbind(rownames(maize),maize)
rownames(maize) <- NULL
colnames(maize) <- maize[1,]
maize <- maize[-1,]
maize <- as.data.frame(maize)
colnames(maize)[1] <- "SNP_ID" 
maizewp <- merge(posred,maize,by = "SNP_ID")
maizewp <- maizewp %>% arrange(Chromosome,Position) 
## maize genotypes with SNP position information

```


##Formatting the teosinte file to merge the redPos and maize file
```{r}

teosinte <- teosinte[,c(-2,-3)]
teosinte <- t(teosinte)
teosinte <- cbind(rownames(teosinte),teosinte)
rownames(teosinte) <- NULL
colnames(teosinte) <- teosinte[1,]
teosinte <- teosinte[-1,]
teosinte <- as.data.frame(teosinte)
colnames(teosinte)[1] <- "SNP_ID" 
teosintewp <- merge(posred,teosinte,by = "SNP_ID")
teosintewp <- teosintewp %>% arrange(Chromosome,Position)



```

## Splitting the maize data into different files by chromosomes and SNP positions. 




```{r}
chr <- 1:10
for (i in chr) {
  files_inc <- maizewp[maizewp$Chromosome == i,]
  files_inc[files_inc == "?/?"] <- "?"
  if (i < 10) { write.table(files_inc, file = paste("Maize_Chr0",i,"_increase.txt",sep=""),row.names = FALSE,sep = "\t",quote = FALSE) }
  else {write.table(files_inc, file = paste("Maize_Chr",i,"_increase.txt",sep=""),row.names = FALSE, sep = "\t",quote = FALSE)}
  
  files_dec <- maizewp[maizewp$Chromosome == i,]
  files_dec[files_dec == "?/?"] <- "-"
  files_dec <- files_dec %>% arrange(desc(Chromosome),desc(Position))
  if (i < 10) { write.table(files_dec, file = paste("Maize_Chr0",i,"_decrease.txt",sep=""),row.names = FALSE,sep = "\t",quote = FALSE) }
  else {write.table(files_dec, file = paste("Maize_Chr",i,"_decrease.txt",sep=""),row.names = FALSE, sep = "\t",quote = FALSE)}
}
  

```


## Splitting the teosinte data into different files by chromosomes and SNP positions.

```{r}

chr <- 1:10
for (i in chr) {
  files_inc <- teosintewp[teosintewp$Chromosome == i,]
  files_inc[files_inc == "?/?"] <- "?"
  if (i < 10) { write.table(files_inc, file = paste("Teosinte_Chr0",i,"_increase.txt",sep=""),row.names = FALSE,sep = "\t",quote = FALSE) }
  else {write.table(files_inc, file = paste("Teosinte_Chr",i,"_increase.txt",sep=""),row.names = FALSE, sep = "\t",quote = FALSE)}
  
  files_dec <- teosintewp[teosintewp$Chromosome == i,]
  files_dec[files_dec == "?/?"] <- "-"
  files_dec <- files_dec %>% arrange(desc(Chromosome),desc(Position))
  if (i < 10) { write.table(files_dec, file = paste("Teosinte_Chr0",i,"_decrease.txt",sep=""),row.names = FALSE,sep = "\t",quote = FALSE) }
  else {write.table(files_dec, file = paste("Teosinte_Chr",i,"_decrease.txt",sep=""),row.names = FALSE, sep = "\t",quote = FALSE)}
}

```




